<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì„¸ê³„ ì¸êµ¬ ëŒ€ì‹œë³´ë“œ</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f5f5;
      }
      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .header-content {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .header h1 {
        font-size: 28px;
      }
      .logout-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 1px solid white;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        transition: background 0.3s;
      }
      .logout-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }
      .container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 0 20px;
      }
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }
      .stat-card {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .stat-card h3 {
        color: #666;
        font-size: 14px;
        margin-bottom: 10px;
      }
      .stat-card .value {
        font-size: 32px;
        font-weight: bold;
        color: #667eea;
      }
      .section {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      .section h2 {
        margin-bottom: 20px;
        color: #333;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }
      th {
        background: #f8f9fa;
        font-weight: 600;
        color: #555;
      }
      tr:hover {
        background: #f8f9fa;
      }
      .country-flag-small {
        width: 32px;
        height: 21px;
        object-fit: cover;
        border-radius: 3px;
        vertical-align: middle;
        margin-right: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      }
      .country-name-cell {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .pagination {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
      }
      .pagination a {
        padding: 8px 15px;
        background: #667eea;
        color: white;
        text-decoration: none;
        border-radius: 5px;
        transition: background 0.3s;
      }
      .pagination a:hover {
        background: #764ba2;
      }
      .pagination .active {
        background: #764ba2;
      }
      .search-box {
        margin-bottom: 20px;
      }
      .search-box input {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="header-content">
        <h1>ğŸŒ ì„¸ê³„ ì¸êµ¬ ëŒ€ì‹œë³´ë“œ</h1>
        <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>

    <div class="container">
      <!-- í†µê³„ ì¹´ë“œ -->
      <div class="stats-grid">
        <div class="stat-card">
          <h3>ì „ ì„¸ê³„ ì´ ì¸êµ¬</h3>
          <div
            class="value"
            th:text="${#numbers.formatInteger(totalPopulation, 0, 'COMMA')}"
          >
            8,000,000,000
          </div>
        </div>
        <div class="stat-card">
          <h3>êµ­ê°€ ìˆ˜</h3>
          <div class="value" th:text="${pageInfo.total}">195</div>
        </div>
        <div class="stat-card">
          <h3>ëŒ€ë¥™ ìˆ˜</h3>
          <div class="value" th:text="${continentStats.size()}">6</div>
        </div>
      </div>

      <!-- ëŒ€ë¥™ë³„ í†µê³„ -->
      <div class="section">
        <h2>ëŒ€ë¥™ë³„ ì¸êµ¬ í†µê³„</h2>
        <table>
          <thead>
            <tr>
              <th>ëŒ€ë¥™</th>
              <th>êµ­ê°€ ìˆ˜</th>
              <th>ì´ ì¸êµ¬</th>
              <th>í‰ê·  ì¸êµ¬</th>
              <th>í‰ê·  GDP</th>
              <th>í‰ê·  ê¸°ëŒ€ìˆ˜ëª…</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="stat : ${continentStats}">
              <td>
                <a
                  th:href="@{/continent/{continent}(continent=${stat.continent})}"
                  th:text="${stat.continent}"
                  >Asia</a
                >
              </td>
              <td th:text="${stat.country_count}">50</td>
              <td
                th:text="${#numbers.formatInteger(stat.total_population, 0, 'COMMA')}"
              >
                4,500,000,000
              </td>
              <td
                th:text="${#numbers.formatInteger(stat.avg_population, 0, 'COMMA')}"
              >
                90,000,000
              </td>
              <td
                th:text="${'$' + #numbers.formatDecimal(stat.avg_gdp, 0, 'COMMA', 2, 'POINT')}"
              >
                $15,000
              </td>
              <td
                th:text="${#numbers.formatDecimal(stat.avg_life_expectancy, 0, 2)}"
              >
                75.5
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- ì¸êµ¬ ìƒìœ„ êµ­ê°€ -->
      <div class="section">
        <h2>ì¸êµ¬ ìƒìœ„ 10ê°œêµ­</h2>
        <table>
          <thead>
            <tr>
              <th>ìˆœìœ„</th>
              <th>êµ­ê°€</th>
              <th>ëŒ€ë¥™</th>
              <th>ì¸êµ¬</th>
              <th>ì¸êµ¬ ë°€ë„</th>
              <th>ê¸°ëŒ€ìˆ˜ëª…</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="country, iterStat : ${topCountries}">
              <td th:text="${iterStat.count}">1</td>
              <td>
                <div class="country-name-cell">
                  <img
                    th:src="'https://flagcdn.com/w40/' + ${#strings.toLowerCase(country.countryCode)} + '.png'"
                    th:alt="${country.countryName}"
                    class="country-flag-small"
                    onerror="this.style.display='none'"
                  />
                  <a
                    th:href="@{/country/{code}(code=${country.countryCode})}"
                    th:text="${country.countryName}"
                    >ì¤‘êµ­</a
                  >
                </div>
              </td>
              <td th:text="${country.continent}">Asia</td>
              <td
                th:text="${#numbers.formatInteger(country.population, 0, 'COMMA')}"
              >
                1,400,000,000
              </td>
              <td
                th:text="${#numbers.formatDecimal(country.populationDensity, 0, 'COMMA', 2, 'POINT')}"
              >
                150.5
              </td>
              <td
                th:text="${#numbers.formatDecimal(country.lifeExpectancy, 0, 2)}"
              >
                76.9
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- ì „ì²´ êµ­ê°€ ëª©ë¡ -->
      <div class="section">
        <h2>ì „ì²´ êµ­ê°€ ëª©ë¡</h2>

        <div class="search-box">
          <form th:action="@{/search}" method="get">
            <input type="text" name="keyword" placeholder="êµ­ê°€ëª… ê²€ìƒ‰..." />
          </form>
        </div>

        <table>
          <thead>
            <tr>
              <th>êµ­ê°€ ì½”ë“œ</th>
              <th>êµ­ê°€ëª…</th>
              <th>ëŒ€ë¥™</th>
              <th>ì¸êµ¬</th>
              <th>ë©´ì  (kmÂ²)</th>
              <th>GDP (1ì¸ë‹¹)</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="country : ${countries}">
              <td th:text="${country.countryCode}">KOR</td>
              <td>
                <div class="country-name-cell">
                  <img
                    th:src="'https://flagcdn.com/w40/' + ${#strings.toLowerCase(country.countryCode)} + '.png'"
                    th:alt="${country.countryName}"
                    class="country-flag-small"
                    onerror="this.style.display='none'"
                  />
                  <a
                    th:href="@{/country/{code}(code=${country.countryCode})}"
                    th:text="${country.countryName}"
                    >ëŒ€í•œë¯¼êµ­</a
                  >
                </div>
              </td>
              <td th:text="${country.continent}">Asia</td>
              <td
                th:text="${#numbers.formatInteger(country.population, 0, 'COMMA')}"
              >
                51,000,000
              </td>
              <td
                th:text="${#numbers.formatDecimal(country.areaSqKm, 0, 'COMMA', 2, 'POINT')}"
              >
                100,210
              </td>
              <td
                th:text="${'$' + #numbers.formatDecimal(country.gdpPerCapita, 0, 'COMMA', 2, 'POINT')}"
              >
                $34,165
              </td>
            </tr>
          </tbody>
        </table>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div class="pagination" th:if="${pageInfo.pages > 1}">
          <a
            th:if="${pageInfo.hasPreviousPage}"
            th:href="@{/dashboard(page=${pageInfo.prePage}, size=${pageInfo.pageSize})}"
            >ì´ì „</a
          >

          <a
            th:each="i : ${#numbers.sequence(1, pageInfo.pages)}"
            th:href="@{/dashboard(page=${i}, size=${pageInfo.pageSize})}"
            th:text="${i}"
            th:classappend="${i == pageInfo.pageNum} ? 'active' : ''"
            >1</a
          >

          <a
            th:if="${pageInfo.hasNextPage}"
            th:href="@{/dashboard(page=${pageInfo.nextPage}, size=${pageInfo.pageSize})}"
            >ë‹¤ìŒ</a
          >
        </div>
      </div>
    </div>

    <script>
      async function logout() {
        try {
          await fetch("/api/auth/logout", { method: "POST" });
          window.location.href = "/login";
        } catch (error) {
          console.error("ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:", error);
        }
      }
    </script>
  </body>
</html>
